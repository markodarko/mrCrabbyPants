<HTML>

<CENTER><CANVAS id='gamewindow'></CANVAS></CENTER>
<STYLE>
canvas{
	display:block;
	background:#f8d878;
	user-select:none;
}
</STYLE>

<SCRIPT>

var canvas = document.getElementById('gamewindow')
var ctx = canvas.getContext('2d')

const C_WIDTH = C_HEIGHT = canvas.width = canvas.height = 400;
const GRID = 20;
const COLORS = {
	red:'#e40058',
	yellow:'#f8d878',
	orange:'#f87858'
}
var controller = {
	up: 0,
	pressed:0,
	down: 0
}

function collideCheck(obj1,obj2,dx=0,dy=0){
	const 	x1 = obj1.x + obj1.offsetX,
			x2 = obj2.x + obj2.offsetX,
			y1 = obj1.y + obj1.offsetY,
			y2 = obj2.y + obj2.offsetY,
			w1 = obj1.w - obj1.offsetX * 2,
			w2 = obj2.w - obj2.offsetX * 2,
			h1 = obj1.h - obj1.offsetY * 2,
			h2 = obj2.h - obj2.offsetY * 2;
	if ((x1 + dx >= x2 + w2) || (x1 + w1 + dx <= x2)) return;
	if ((y1 + dy >= y2 + h2) || (y1 + h1 + dy <= y2)) return;
	return 1;
}


class Block{
	constructor(x,y,offsetX = 0,offsetY = 0){
		this.x = x * GRID;
		this.y = y * GRID;
		this.w = this.h = GRID;
		this.offsetX = offsetX;
		this.offsetY = offsetY;
		this.color = COLORS.orange
	}
	draw(){
		ctx.fillStyle = this.color
		ctx.fillRect(this.x,this.y,this.w,this.h)
	}
}

class PlayerCrab extends Block{
	constructor(x,y){
		super(x,y,8,8)
		this.xSpeed = 4;
		this.ySpeed = 0;
		this.color = COLORS.red;
		this.position = y;
		this.state = 'horizontal'
	}
	update(){
		const walls = GAME.getWalls()
		
		switch (this.state){
			case 'horizontal':
				this.x += this.xSpeed;
				for (let i=0; i<walls.length; i++){
				if (collideCheck(this,walls[i],this.xSpeed,0)){
					this.xSpeed *= -1;
					break;
					}
				}
				this.screenCheck()
				this.inputCheckY()
			break;
			
			case 'vertical':
				this.y += this.ySpeed
				for (let i=0; i<walls.length; i++){
				if (collideCheck(this,walls[i],0,this.ySpeed)){
					this.ySpeed *= -1;
					break;
					}
				}
				if (this.y % GRID == 0) this.state = 'horizontal'
			break;
			
			case 'dead':
			break;
		}

		
		
	}
	draw(){
		super.draw()
	}
	screenCheck(){
		const leftSide = 0 - this.w
		if (this.x > C_WIDTH) this.x = leftSide;
		else if(this.x < leftSide) this.x = C_WIDTH;
	}
	inputCheckY(){
		if (this.x < 0 || this.x > C_WIDTH - GRID) return;
		const verticalMove = controller.down-controller.up
		if (verticalMove != 0 && controller.pressed==0) {
			this.state = 'vertical'
			this.ySpeed = verticalMove * 4
			controller.pressed = 1	
		}
	}
}

var levels = {
	1:BuildLevel(
	[
	'1..................1',
	'1..1......1........1',
	'1..................1',
	'1..................1',
	'1............111...1',
	'1...11.............1',
	'1..................1',
	'....................',
	'1.....1............1',
	'1..................1',
	'1..................1',
	'....................',
	'1........1.........1',
	'1..................1',
	'1..................1',
	'1......1...........1',
	'1......1...........1',
	'1....1111111.......1',
	'1..................1',
	'1..................1'
	])
}

function BuildLevel(map){
	var walls = [];
	for (let row = 0; row<map.length; row++){
		for (let col=0; col < map[row].length; col++){
			switch(map[row][col]){
				case '1':walls.push(new Block(col,row))
			}
		}
	}
	return {walls:walls, allOBJs:[...walls]}
}
function drawLevel(level){
	level.allOBJs.forEach(obj => {
		obj.draw();
	})
}

class GameController{
	constructor(){
		this.player = new PlayerCrab(2,19);
		this.currentLevel = 1;
		this.level = levels[this.currentLevel]
	}
	getWalls(){
		return this.level.walls;
	}
}
var GAME = new GameController

function loop(){
	requestAnimationFrame(loop)
	ctx.clearRect(0,0,C_WIDTH,C_HEIGHT)
	drawLevel(GAME.level)
	GAME.player.draw()
	GAME.player.update()
}

loop()

document.addEventListener('keydown',(e)=>{
	if(e.keyCode == 38){
		controller.up = 1
	}
	else if(e.keyCode == 40){
		controller.down = 1
	}
})

document.addEventListener('keyup',(e)=>{
	controller.pressed = 0;
	controller.down = 0;
	controller.up = 0;
})


</SCRIPT>
</HTML>